<!DOCTYPE html>
<html lang="en">
  <head>
    

<script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("use-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script>

<meta charset="utf-8" >

<title>How Git repositories are blockchains</title>
<meta name="google-site-verification" content="CmjL_aZ8fDb2ZxqOct5raymSCyinEt7dd7JeIro6eig" />
<meta name="keywords" content="How Git repositories are blockchains, blog keywords">
<meta name="description" content="I think most people (even some computer science people, including me) only think of cryptocurrencies anytime when “block">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/style/main.css">


<link rel="stylesheet" href="/style/jquery.fancybox.min.css">




    <link rel="stylesheet" href="/style/prism.css"/>





  <meta name="generator" content="Hexo 7.1.1"></head>
  <body>
    <div id="app" class="main">

<div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://rhythm16.github.io">
        <img class="avatar" src="/images/avatar.png" alt="" width="32px" height="32px">
      </a>
      <a href="https://rhythm16.github.io">
        <h1 class="site-title">rhythm16.github.io</h1>
      </a>
    </div>
    <div class="right">
        <i class="icon menu-switch icon-menu-outline" ></i>
    </div>
  </div>
</div>

<div class="menu-container" style="height: 0;opacity: 0;">
<nav class="menu-list">
  
    
      <a href="/" class="menu purple-link">
        Home
      </a>
    
  
    
      <a href="/tags" class="menu purple-link">
        Tags
      </a>
    
  
    
      <a href="/categories" class="menu purple-link">
        Categories
      </a>
    
  
    
      <a href="/archives" class="menu purple-link">
        Archives
      </a>
    
  
    
      <a href="/about" class="menu purple-link">
        About
      </a>
    
  
</nav>
</div>



  <div class="content-container">
    <div class="post-detail">
      
      <h2 class="post-title">How Git repositories are blockchains</h2>
      <div class="post-info post-detail-info">
        <span><i class="icon icon-calendar-outline"></i> 2021-04-22</span>
        
          <span>
          <i class="icon icon-pricetags-outline"></i>
            
              <a href="/tags/git/">
              git
                
                  ，
                
              </a>
            
              <a href="/tags/blockchain/">
              blockchain
                
              </a>
            
          </span>
        
      </div>
      <div class="post-content-wrapper">
        <div class="post-content">
          <p>I think most people (even some computer science people, including me) only think of cryptocurrencies anytime when “blockchain” is mentioned. However I recently learned a bit about how git works internally and was very surprised by how similar it is to some of the bitcoin&#x2F;blockchain concepts introductions that I have studied. So as a note and sharing of this interesting finding, in this article, I’m going to try to explain how git provides its fundamental functionalities, and hopefully if the reader is somewhat familiar with the basic blockchain concepts, can easily see what I claim in the title of the post.<br>Blockchain knowledge is not required to understand this article, though. I’ll be mostly talking about the git internals. Only basic git knowledge is assumed.</p>
<h2 id="Toy-repo-setup"><a href="#Toy-repo-setup" class="headerlink" title="Toy repo setup"></a>Toy repo setup</h2><p>I’ll setup a simple git repository for demonstration purposes, all commands in this article will be issued in the repo.</p>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup:"></a>Setup:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># be sure to not be in a repository!</span></span><br><span class="line">$ <span class="built_in">mkdir</span> simple_repo</span><br><span class="line">$ <span class="built_in">cd</span> simple_repo</span><br><span class="line">$ git init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /your/path/simple_repo/.git</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;FIRST LINE&quot;</span> &gt; my_file.txt</span><br><span class="line">$ git add my_file.txt</span><br><span class="line">$ git commit -m <span class="string">&quot;add my_file.txt&quot;</span></span><br><span class="line"><span class="comment"># commit info..</span></span><br><span class="line">$ <span class="built_in">mkdir</span> <span class="built_in">dir</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;LINE IN INNER FILE&quot;</span> &gt; <span class="built_in">dir</span>/inner_file.txt</span><br><span class="line">$ git add <span class="built_in">dir</span>/inner_file.txt</span><br><span class="line">$ git commit -m <span class="string">&quot;add inner_file.txt&quot;</span></span><br><span class="line"><span class="comment"># commit info..</span></span><br></pre></td></tr></table></figure>

<h2 id="git-under-the-hood"><a href="#git-under-the-hood" class="headerlink" title="git under the hood"></a>git under the hood</h2><p>In essence, git is a key-value data store with abstraction layers built on top of it which can be used by convenient commands. The key corresponding to a piece of data is generated by hashing the data using SHA-1. All information that git needs in order to work is inside the .git directory under the root of every git repository.<br>There are four types of objects that git hashes and keeps in the data store:</p>
<ul>
<li>blobs (binary large objects)</li>
<li>trees</li>
<li>commits</li>
<li>annotated tags</li>
</ul>
<p>I’ll just go into the initial three of them because they’re enough to paint the picture.<br>In the toy repo, there exists 7 objects saved after the operations above, including blobs, trees and commits (though you won’t be able to tell the types now). You can view them under <code>.git/objects</code>. The first two characters of the hashes are used as names of the subdirectory and the remaining 38 characters are used as file names (SHA-1 produces a 40-character hexadecimal output).</p>
<blockquote>
<p>your hash will not be the same as mine because the input to the hashing function includes username, email, time, etc.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git/objects/</span><br><span class="line">.git/objects/</span><br><span class="line">├── 17</span><br><span class="line">│   └── 1edfe85c938a6d2c7af2f0bb0db6808951be49</span><br><span class="line">├── 29</span><br><span class="line">│   └── 1caa6e2306eca737a3944824676a16fa6a4a39</span><br><span class="line">├── 6f</span><br><span class="line">│   └── e44c47ff76dad4433f9e0df8e717ad03eb9004</span><br><span class="line">├── 72</span><br><span class="line">│   └── 538f3bfde6c5c309abfab4cc47d9428566a621</span><br><span class="line">├── c0</span><br><span class="line">│   └── e23f04d16a2ccda68a117656d92defa2800885</span><br><span class="line">├── d2</span><br><span class="line">│   └── 8a6d4ef745a7bd6e5e0b013ec17ca00b6fbae6</span><br><span class="line">├── f5</span><br><span class="line">│   └── 5db9d5a884e10f0924529629f2dcb117abcaac</span><br><span class="line">├── info</span><br><span class="line">└── pack</span><br><span class="line"></span><br><span class="line">9 directories, 7 files</span><br></pre></td></tr></table></figure>

<h3 id="hash-object-and-cat-file"><a href="#hash-object-and-cat-file" class="headerlink" title="hash-object and cat-file"></a>hash-object and cat-file</h3><p><code>git hash-object</code> and <code>git cat-file</code> are two low level commands that directly interacts with objects, they hash and print objects, respectively.<br>For example we can tell git to hash a string for us:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --stdin means read from stdin</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hi&quot;</span> | git hash-object --stdin </span><br><span class="line">45b983be36b73c0788dc9cbcb76cbb80fc7b057</span><br><span class="line"><span class="comment"># specify the -w flag to store the data in .git/objects/</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hi&quot;</span> | git hash-object --stdin -w <span class="comment"># .git/objects/45/b983be... created</span></span><br><span class="line">45b983be36b73c0788dc9cbcb76cbb80fc7b057</span><br></pre></td></tr></table></figure>

<p>use <code>cat-file</code> to see the data with its key(hash):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 45b983b <span class="comment"># -p stands for pretty-print</span></span><br><span class="line">hi</span><br><span class="line">$ git cat-file -t 45b983b <span class="comment"># -t stands for type</span></span><br><span class="line">blob</span><br></pre></td></tr></table></figure>

<p>With these two commands we can manipulate the git data store directly. However, if you print out or open the raw files inside <code>.git/objects</code>, you won’t be able to read them because git compresses them before saving. Also the compressed information includes some metadata, if not <code>cat-file</code> wouldn’t be able to report back the type.</p>
<h3 id="Blobs-Binary-Large-OBjectS"><a href="#Blobs-Binary-Large-OBjectS" class="headerlink" title="Blobs (Binary Large OBjectS)"></a>Blobs (Binary Large OBjectS)</h3><p>Blobs are objects git uses to store contents of files, not including file names, only the file contents. In my local simple repo, hash d28a6d4.. and hash 171edfe.. correspond to the contents of the two text files created. Check it by <code>cat-file</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -t d28a6d4</span><br><span class="line">blob</span><br><span class="line">$ git cat-file -p d28a6d4</span><br><span class="line">FIRST LINE</span><br><span class="line">$ git cat-file -t 171edfe</span><br><span class="line">blob</span><br><span class="line">$ git cat-file -p 171edfe</span><br><span class="line">LINE IN INNER FILE</span><br></pre></td></tr></table></figure>
<p>A blob is like this:</p>
<table>
<thead>
<tr>
<th>hash</th>
<th>file content</th>
</tr>
</thead>
<tbody><tr>
<td>d28a6d4…</td>
<td>FIRST LINE</td>
</tr>
</tbody></table>
<h3 id="Trees"><a href="#Trees" class="headerlink" title="Trees"></a>Trees</h3><p>Trees are objects git uses to store contents of directories, each directory is stored as a tree object. It’s easier to understand what’s in a tree by looking at an example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -t 72538f3</span><br><span class="line">tree</span><br><span class="line">$ git cat-file -p 72538f3</span><br><span class="line">040000 tree 291caa6e2306eca737a3944824676a16fa6a4a39    <span class="built_in">dir</span></span><br><span class="line">100644 blob d28a6d4ef745a7bd6e5e0b013ec17ca00b6fbae6    my_file.txt</span><br><span class="line">$ git cat-file -t 291caa6</span><br><span class="line">tree</span><br><span class="line">$ git cat-file -p 291caa6</span><br><span class="line">100644 blob 171edfe85c938a6d2c7af2f0bb0db6808951be49    inner_file.txt</span><br></pre></td></tr></table></figure>

<p>The trees are printed out as tables, looking like this:</p>
<table>
<thead>
<tr>
<th>permissions</th>
<th>object type</th>
<th>hash</th>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>040000</td>
<td>tree</td>
<td>291caa6e2306eca737a3944824676a16fa6a4a39</td>
<td>dir</td>
</tr>
<tr>
<td>100644</td>
<td>blob</td>
<td>d28a6d4ef745a7bd6e5e0b013ec17ca00b6fbae6</td>
<td>my_file.txt</td>
</tr>
</tbody></table>
<p>This tree corresponds to the root directory of our toy repository. The interesting thing here is that tree objects can store other tree objects’ information, just like directories(like the ‘dir’ row above). Furthermore, you can see the hash to file name mapping is stored in the tree objects, not in the blob objects.<br>The meaning of the permissions field is explained in <a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/450480/file-permission-with-six-bytes-in-git-what-does-it-mean">this</a> stackoverflow question.</p>
<p>Here’s some visualization I made :)</p>
<img src="/git-chain/git1.png" class="">

<h3 id="commits"><a href="#commits" class="headerlink" title="commits"></a>commits</h3><p>Finally, we come to commits.<br>Commits are the last type of objects I’ll be talking about, and they bring the concepts all together. As the name suggests, each commit you do is stored in a commit object by git, they contain a tree, an author, a parent commit (none for the first commit and 2 for merge commits), a commiter, and the commit message. Let’s see it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -t c0e23f</span><br><span class="line">commit</span><br><span class="line">$ git cat-file -t f55db9</span><br><span class="line">commit</span><br><span class="line">$ git cat-file -p c0e23f</span><br><span class="line">tree 6fe44c47ff76dad4433f9e0df8e717ad03eb9004</span><br><span class="line">author rhythm &lt;rhythm@music.yes&gt; 1618749200 +0800</span><br><span class="line">committer rhythm &lt;rhythm@music.yes&gt; 1618749200 +0800</span><br><span class="line"></span><br><span class="line">add my_file.txt</span><br><span class="line">$ git cat-file -p f55db9</span><br><span class="line">tree 72538f3bfde6c5c309abfab4cc47d9428566a621</span><br><span class="line">parent c0e23f04d16a2ccda68a117656d92defa2800885</span><br><span class="line">author rhythm &lt;rhythm@music.yes&gt; 1618749484 +0800</span><br><span class="line">committer rhythm &lt;rhythm@music.yes&gt; 1618749484 +0800</span><br><span class="line"></span><br><span class="line">add inner_file.txt</span><br></pre></td></tr></table></figure>
<p>The diagram below shows the structure git uses to keep track of commits and their contents. <strong>NOTE</strong> that the arrow pointing from <code>commit f55db</code>‘s parent field to <code>commit c0e23</code> is missing, the reason is that I just can’t get it to work without the graphviz engine making a mess. So you’ll have to imagine for yourself. I hope you get the point though.</p>
<img src="/git-chain/git2.png" class="">

<h2 id="Git-repos-are-blockchains"><a href="#Git-repos-are-blockchains" class="headerlink" title="Git repos are blockchains"></a>Git repos are blockchains</h2><p>From the explanation above, we can see the git commit data structure is something like this:</p>
<img src="/git-chain/git3.png" class="">

<p>The commits have the following properties:</p>
<ul>
<li>acyclic</li>
<li>hash based back-pointing</li>
<li>stores the merkle root of the data it corresponds to</li>
<li>contains timestamp</li>
</ul>
<p>IMO, these are the properties blockchains possess, but there are voices from both sides, see <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/46192377/why-is-git-not-considered-a-block-chain">this SO question</a> and <a target="_blank" rel="noopener" href="https://medium.com/@shemnon/is-a-git-repository-a-blockchain-35cb1cd2c491">this medium post</a>. As far as I know, the term blockchain isn’t rigorously defined, so there’s no definitive answer.</p>
<h2 id="Acknowledgement"><a href="#Acknowledgement" class="headerlink" title="Acknowledgement"></a>Acknowledgement</h2><p>I learned most of the material in this post from the amazing <a target="_blank" rel="noopener" href="https://www.udemy.com/course/git-and-github-bootcamp/?utm_source=adwords&utm_medium=udemyads&utm_campaign=LongTail_la.EN_cc.ROW&utm_content=deal4584&utm_term=_._ag_77879424134_._ad_437497333833_._kw__._de_c_._dm__._pl__._ti_dsa-1007766171312_._li_9040379_._pd__._&matchtype=b&gclid=EAIaIQobChMIysO8j8mR8AIVDq2WCh24YgHCEAAYASAAEgLPdPD_BwE">Udemy course</a> taught by Colt Steele. I highly recommend it to people who want to have a solid foundation on git&#x2F;github.</p>
<h2 id="Some-other-good-references"><a href="#Some-other-good-references" class="headerlink" title="Some other good references"></a>Some other good references</h2><p><a target="_blank" rel="noopener" href="https://www.linkedin.com/pulse/git-internals-how-works-kaushik-rangadurai/">git internals</a></p>

        </div>
        <div class="top-div">
          <ol class="top-box"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#Toy-repo-setup"><span class="top-box-text">Toy repo setup</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#Setup"><span class="top-box-text">Setup:</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#git-under-the-hood"><span class="top-box-text">git under the hood</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#hash-object-and-cat-file"><span class="top-box-text">hash-object and cat-file</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#Blobs-Binary-Large-OBjectS"><span class="top-box-text">Blobs (Binary Large OBjectS)</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#Trees"><span class="top-box-text">Trees</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#commits"><span class="top-box-text">commits</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#Git-repos-are-blockchains"><span class="top-box-text">Git repos are blockchains</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#Acknowledgement"><span class="top-box-text">Acknowledgement</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#Some-other-good-references"><span class="top-box-text">Some other good references</span></a></li></ol>
        </div>
      </div>
    </div>

    
      <div class="next-post">
        <a class="purple-link" href="/GOTPLT/">
          <h3 class="post-title">
            Next: Linux/ELF動態鏈結部分機制(GOT&amp;PLT)
          </h3>
        </a>
      </div>
    
  </div>




<footer>
<div class="site-footer">
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a>
  
  
  
  
  
  
</div>
</footer>


      </div>
      
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>



    <script>window.is_post = true;</script>


<script src="/js/main.js"></script>





    </div>
  </body>
</html>

