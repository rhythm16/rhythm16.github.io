<!DOCTYPE html>
<html lang="en">
  <head>
    

<script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("use-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script>

<meta charset="utf-8" >

<title>Casting a `char` to an `unsigned int` sign extends</title>
<meta name="google-site-verification" content="CmjL_aZ8fDb2ZxqOct5raymSCyinEt7dd7JeIro6eig" />
<meta name="keywords" content="Casting a `char` to an `unsigned int` sign extends, blog keywords">
<meta name="description" content="Let’s look at this snippet of code:
12345678#include &lt;stdio.h&gt;int main() &#123;	char a = 0xFF;	unsigned char b = 0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/style/main.css">


<link rel="stylesheet" href="/style/jquery.fancybox.min.css">




    <link rel="stylesheet" href="/style/prism.css"/>





  <meta name="generator" content="Hexo 7.1.1"></head>
  <body>
    <div id="app" class="main">

<div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://rhythm16.github.io">
        <img class="avatar" src="/images/avatar.png" alt="" width="32px" height="32px">
      </a>
      <a href="https://rhythm16.github.io">
        <h1 class="site-title">rhythm16.github.io</h1>
      </a>
    </div>
    <div class="right">
        <i class="icon menu-switch icon-menu-outline" ></i>
    </div>
  </div>
</div>

<div class="menu-container" style="height: 0;opacity: 0;">
<nav class="menu-list">
  
    
      <a href="/" class="menu purple-link">
        Home
      </a>
    
  
    
      <a href="/tags" class="menu purple-link">
        Tags
      </a>
    
  
    
      <a href="/categories" class="menu purple-link">
        Categories
      </a>
    
  
    
      <a href="/archives" class="menu purple-link">
        Archives
      </a>
    
  
    
      <a href="/about" class="menu purple-link">
        About
      </a>
    
  
</nav>
</div>



  <div class="content-container">
    <div class="post-detail">
      
      <h2 class="post-title">Casting a `char` to an `unsigned int` sign extends</h2>
      <div class="post-info post-detail-info">
        <span><i class="icon icon-calendar-outline"></i> 2024-06-17</span>
        
          <span>
          <i class="icon icon-pricetags-outline"></i>
            
              <a href="/tags/C/">
              C
                
              </a>
            
          </span>
        
      </div>
      <div class="post-content-wrapper">
        <div class="post-content">
          <p>Let’s look at this snippet of code:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">char</span> a = <span class="number">0xFF</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> b = <span class="number">0xFF</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%x, %x\n&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)a, (<span class="type">unsigned</span> <span class="type">int</span>)b);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As the title indicates, the result of the program is:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffffffff, ff</span><br></pre></td></tr></table></figure>

<p>I am actually unsure whether people would find this result unexpected or not, if anything, I am a bit surprised :)</p>
<p>Let’s see why:</p>
<p>Section 6.3.1.3 <em>Signed and unsigned integers</em> of the latest C standard draft shows</p>
<blockquote>
<p>1 When a value with integer type is converted to another integer type other than bool, if the value can be represented by the new type, it is unchanged.</p>
</blockquote>
<blockquote>
<p>2 Otherwise, if the new type is unsigned, the value is converted by repeatedly adding or subtracting one more than the maximum value that can be represented in the new type until the value is in the range of the new type.</p>
</blockquote>
<blockquote>
<p>3 Otherwise, the new type is signed and the value cannot be represented in it; either the result is implementation-defined or an implementation-defined signal is raised.</p>
</blockquote>
<p>The first part is self-explanatory. The second part is the one which applies to the example above, but the wording is a little convoluted. Simply put, if the type to be cast to (<code>unsigned int</code>) cannot represent the value being cast (0xFF, -1), then take the largest value which can be represented by the type to be cast to, add one to it, then use the result to add or subtract the value to be cast, until the new type can represent it.</p>
<p>In other words, if the value to be cast is X, and the maximum value that can be represented by the new type is Y, then calculate</p>
<p>X + (Y + 1)<br>X + 2(Y + 1)<br>X + 3(Y + 1)<br>…</p>
<p>or</p>
<p>X - (Y + 1)<br>X - 2(Y + 1)<br>X - 3(Y + 1)<br>…</p>
<p>and see which one can be represented by the type to be cast to first.</p>
<p>For our example, the maximum value of the type being cast to (<code>unsigned int</code>) is 2^32 - 1, so Y &#x3D; 2^32 - 1, and Y + 1 is 2^32. Next, directly observe that X + (Y + 1) → -1 + (2^32 - 1 + 1) → -1 + 2^32 → 2^32 - 1 is a value representable by <code>unsigned int</code> (<code>0xFFFFFFFF</code>).</p>
<p>Therefore, casting a <code>char</code> to an <code>unsigned int</code> sign extends, since <code>unsigned int</code> is unable to represent negative values, and X + (Y + 1) is 2^32 - |X| for the negative value, which is the two’s complement representation of X.</p>
<p>Interestingly in 6.2.5 <em>Types</em>:</p>
<blockquote>
<p>20 The three types char, signed char, and unsigned char are collectively called the character types. The implementation shall define char to have the same range, representation, and behavior as either signed char or unsigned char.</p>
</blockquote>
<p><code>char</code> can actually be <code>unsigned char</code> depending on the implementation, in such cases the argument does not stand, because 0xFF would be 255 and not -1.</p>
<p>Additionally, <code>char</code> is an integer type (6.2.5 <em>Types</em>):</p>
<blockquote>
<p>There are five standard signed integer types, designated as <code>signed char</code>, <code>short int</code>, <code>int</code>, <code>long int</code>, and <code>long long int</code>.</p>
</blockquote>
<p>also, this in the example</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> a = <span class="number">0xFF</span>;</span><br></pre></td></tr></table></figure>

<p>is actually implementation defined, from 6.4.4.1 <em>integer constants</em>, <code>0xFF</code> is categorized as an <code>int</code> , so the value would be 255, which cannot be represented by <code>char</code> (-128 ~ 127), and the third rule above applies to this cast&#x2F;conversion.</p>

        </div>
        <div class="top-div">
          
        </div>
      </div>
    </div>

    
      <div class="next-post">
        <a class="purple-link" href="/casting/">
          <h3 class="post-title">
            Next: 把`char`cast成`unsigned int`會sign extend
          </h3>
        </a>
      </div>
    
  </div>




<footer>
<div class="site-footer">
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a>
  
  
  
  
  
  
</div>
</footer>


      </div>
      
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.fancybox.min.js"></script>



    <script>window.is_post = true;</script>


<script src="/js/main.js"></script>





    </div>
  </body>
</html>

